{
   "components":{
      "comp-endpoint-create":{
         "executorLabel":"exec-endpoint-create",
         "inputDefinitions":{
            "parameters":{
               "display_name":{
                  "parameterType":"STRING"
               },
               "endpoint_name":{
                  "parameterType":"STRING"
               },
               "location":{
                  "parameterType":"STRING"
               },
               "project":{
                  "parameterType":"STRING"
               }
            }
         },
         "outputDefinitions":{
            "artifacts":{
               "endpoint":{
                  "artifactType":{
                     "schemaTitle":"google.VertexEndpoint",
                     "schemaVersion":"0.0.1"
                  }
               }
            },
            "parameters":{
               "gcp_resources":{
                  "parameterType":"STRING"
               }
            }
         }
      },
      "comp-model-deploy":{
         "executorLabel":"exec-model-deploy",
         "inputDefinitions":{
            "artifacts":{
               "endpoint":{
                  "artifactType":{
                     "schemaTitle":"google.VertexEndpoint",
                     "schemaVersion":"0.0.1"
                  }
               },
               "model":{
                  "artifactType":{
                     "schemaTitle":"google.VertexModel",
                     "schemaVersion":"0.0.1"
                  }
               }
            },
            "parameters":{
               "accelerator_count":{
                  "parameterType":"NUMBER_INTEGER"
               },
               "accelerator_type":{
                  "parameterType":"STRING"
               },
               "machine_type":{
                  "parameterType":"STRING"
               },
               "max_replica_count":{
                  "parameterType":"NUMBER_INTEGER"
               },
               "min_replica_count":{
                  "parameterType":"NUMBER_INTEGER"
               },
               "deployed_model_display_name":{
                  "parameterType":"STRING"
               },
               "explanation_metadata":{
                  "parameterType":"STRUCT"
               },
               "explanation_parameters":{
                  "parameterType":"STRUCT"
               },
               "service_account":{
                  "parameterType":"STRING"
               },
               "traffic_split":{
                  "parameterType":"STRUCT"
               },
               "encryption_spec_key_name":{
                  "parameterType":"STRING"
               },
               "network":{
                  "parameterType":"STRING"
               },
               "sync":{
                  "parameterType":"BOOLEAN"
               },
               "deploy_request_timeout":{
                  "parameterType":"NUMBER_FLOAT"
               },
               "autoscaling_target_cpu_utilization":{
                  "parameterType":"NUMBER_INTEGER"
               },
               "autoscaling_target_accelerator_duty_cycle":{
                  "parameterType":"NUMBER_INTEGER"
               }
            }
         },
         "outputDefinitions":{
            "artifacts":{
               "endpoint":{
                  "artifactType":{
                     "schemaTitle":"google.VertexEndpoint",
                     "schemaVersion":"0.0.1"
                  }
               }
            },
            "parameters":{
               "gcp_resources":{
                  "parameterType":"STRING"
               }
            }
         }
      },
      "comp-model-undeploy":{
         "executorLabel":"exec-model-undeploy",
         "inputDefinitions":{
            "artifacts":{
               "endpoint":{
                  "artifactType":{
                     "schemaTitle":"google.VertexEndpoint",
                     "schemaVersion":"0.0.1"
                  }
               },
               "model":{
                  "artifactType":{
                     "schemaTitle":"google.VertexModel",
                     "schemaVersion":"0.0.1"
                  }
               }
            }
         },
         "outputDefinitions":{
            "parameters":{
               "gcp_resources":{
                  "parameterType":"STRING"
               }
            }
         }
      },
      "comp-model-upload":{
         "executorLabel":"exec-model-upload",
         "inputDefinitions":{
            "parameters":{
               "artifact_uri":{
                  "parameterType":"STRING"
               },
               "display_name":{
                  "parameterType":"STRING"
               },
               "project":{
                  "parameterType":"STRING"
               },
               "serving_container_image_uri":{
                  "parameterType":"STRING"
               }
            }
         },
         "outputDefinitions":{
            "artifacts":{
               "model":{
                  "artifactType":{
                     "schemaTitle":"google.VertexModel",
                     "schemaVersion":"0.0.1"
                  }
               }
            },
            "parameters":{
               "gcp_resources":{
                  "parameterType":"STRING"
               }
            }
         }
      }
   },
   "deploymentSpec":{
      "executors":{
         "exec-endpoint-create":{
            "container":{
               "args":[
                  "--init.project",
                  "{{$.inputs.parameters['project']}}",
                  "--init.location",
                  "{{$.inputs.parameters['location']}}",
                  "--init.endpoint_name",
                  "{{$.inputs.parameters['endpoint_name']}}",
                  "--method.project",
                  "{{$.inputs.parameters['project']}}",
                  "--method.location",
                  "{{$.inputs.parameters['location']}}",
                  "--method.display_name",
                  "{{$.inputs.parameters['display_name']}}",
                  "--method.description",
                  "{{$.inputs.parameters['description']}}",
                  "--method.labels",
                  "{{$.inputs.parameters['labels']}}",
                  "--method.encryption_spec_key_name",
                  "{{$.inputs.parameters['encryption_spec_key_name']}}",
                  "--gcp_resources",
                  "{{$.outputs.parameters['gcp_resources'].output_file}}",
                  "--executor_input",
                  "{{$}}"
               ],
               "command":[
                  "python3",
                  "-u",
                  "-m",
                  "google_cloud_pipeline_components.container.aiplatform.remote_runner, --cls_name, Endpoint, --method_name, create"
               ],
               "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
            }
         },
         "exec-model-deploy":{
            "container":{
               "args":[
                  "--init.model_name",
                  "{{$.inputs.artifacts['model'].metadata['resourceName']}}",
                  "--method.endpoint",
                  "{{$.inputs.artifacts['endpoint'].metadata['resourceName']}}",
                  "--method.deployed_model_display_name",
                  "{{$.inputs.parameters['deployed_model_display_name']}}",
                  "--method.traffic_split",
                  "{{$.inputs.parameters['traffic_split']}}",
                  "--method.machine_type",
                  "{{$.inputs.parameters['machine_type']}}",
                  "--method.min_replica_count",
                  "{{$.inputs.parameters['min_replica_count']}}",
                  "--method.max_replica_count",
                  "{{$.inputs.parameters['max_replica_count']}}",
                  "--method.accelerator_type",
                  "{{$.inputs.parameters['accelerator_type']}}",
                  "--method.accelerator_count",
                  "{{$.inputs.parameters['accelerator_count']}}",
                  "--method.service_account",
                  "{{$.inputs.parameters['service_account']}}",
                  "--method.explanation_metadata",
                  "{{$.inputs.parameters['explanation_metadata']}}",
                  "--method.explanation_parameters",
                  "{{$.inputs.parameters['explanation_parameters']}}",
                  "--method.encryption_spec_key_name",
                  "{{$.inputs.parameters['encryption_spec_key_name']}}",
                  "--method.network",
                  "{{$.inputs.parameters['network']}}",
                  "--method.sync",
                  "{{$.inputs.parameters['sync']}}",
                  "--method.deploy_request_timeout",
                  "{{$.inputs.parameters['deploy_request_timeout']}}",
                  "--method.autoscaling_target_cpu_utilization",
                  "{{$.inputs.parameters['autoscaling_target_cpu_utilization']}}",
                  "--method.autoscaling_target_accelerator_duty_cycle",
                  "{{$.inputs.parameters['autoscaling_target_accelerator_duty_cycle']}}",                  
                  "--gcp_resources",
                  "{{$.outputs.parameters['gcp_resources'].output_file}}",
                  "--executor_input",
                  "{{$}}"
               ],
               "command":[
                  "python3",
                  "-u",
                  "-m",
                  "google_cloud_pipeline_components.container.aiplatform.remote_runner, --cls_name, Model, --method_name, deploy"
               ],
               "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
            }
         },
         "exec-model-undeploy":{
            "container":{
               "args":[
                  "--type",
                  "UndeployModel",
                  "--payload",
                  "{\"endpoint\": \"{{$.inputs.artifacts['endpoint'].metadata['resourceName']}}\", \"model\": \"{{$.inputs.artifacts['model'].metadata['resourceName']}}\", \"traffic_split\": }",
                  "--project",
                  "",
                  "--location",
                  "",
                  "--gcp_resources",
                  "{{$.outputs.parameters['gcp_resources'].output_file}}"
               ],
               "command":[
                  "python3",
                  "-u",
                  "-m",
                  "google_cloud_pipeline_components.container.v1.endpoint.undeploy_model.launcher"
               ],
               "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
            }
         },
         "exec-model-upload":{
            "container":{
               "args":[
                  "--type",
                  "UploadModel",
                  "--payload",
                  "{\"display_name\": \"{{$.inputs.parameters['display_name']}}\", \"description\": \"\", \"predict_schemata\": {\"instance_schema_uri\": \"\", \"parameters_schema_uri\": \"\", \"prediction_schema_uri\": \"\"}, \"container_spec\": {\"image_uri\": \"{{$.inputs.parameters['serving_container_image_uri']}}\", \"command\": , \"args\": , \"env\": , \"ports\": , \"predict_route\": \"\", \"health_route\": \"\"}, \"artifact_uri\": \"{{$.inputs.parameters['artifact_uri']}}\", \"explanation_spec\": {\"parameters\": , \"metadata\": }, \"encryption_spec\": {\"kms_key_name\":\"\"}, \"labels\": }",
                  "--project",
                  "{{$.inputs.parameters['project']}}",
                  "--location",
                  "--gcp_resources",
                  "{{$.outputs.parameters['gcp_resources'].output_file}}",
                  "--executor_input",
                  "{{$}}"
               ],
               "command":[
                  "python3",
                  "-u",
                  "-m",
                  "google_cloud_pipeline_components.container.v1.model.upload_model.launcher"
               ],
               "image":"gcr.io/ml-pipeline/google-cloud-pipeline-components:latest"
            }
         }
      }
   },
   "pipelineInfo":{
      "name":"training-test"
   },
   "root":{
      "dag":{
         "tasks":{
            "endpoint-create":{
               "cachingOptions":{
                  "enableCache":true
               },
               "componentRef":{
                  "name":"comp-endpoint-create"
               },
               "inputs":{
                  "parameters":{
                     "display_name":{
                        "runtimeValue":{
                           "constant":"test_display_name"
                        }
                     },
                     "location":{
                        "runtimeValue":{
                           "constant":"us-central1"
                        }
                     },
                     "project":{
                        "runtimeValue":{
                           "constant":"test_project"
                        }
                     }
                  }
               },
               "taskInfo":{
                  "name":"endpoint-create"
               }
            },
            "model-deploy":{
               "cachingOptions":{
                  "enableCache":true
               },
               "componentRef":{
                  "name":"comp-model-deploy"
               },
               "dependentTasks":[
                  "endpoint-create",
                  "model-upload"
               ],
               "inputs":{
                  "artifacts":{
                     "endpoint":{
                        "taskOutputArtifact":{
                           "outputArtifactKey":"endpoint",
                           "producerTask":"endpoint-create"
                        }
                     },
                     "model":{
                        "taskOutputArtifact":{
                           "outputArtifactKey":"model",
                           "producerTask":"model-upload"
                        }
                     }
                  },
                  "parameters":{
                     "accelerator_count":{
                        "runtimeValue":{
                           "constant":1.0
                        }
                     },
                     "accelerator_type":{
                        "runtimeValue":{
                           "constant":"fake-accelerator"
                        }
                     },
                     "machine_type":{
                        "runtimeValue":{
                           "constant":"n1-standard-4"
                        }
                     },
                     "max_replica_count":{
                        "runtimeValue":{
                           "constant":2.0
                        }
                     },
                     "min_replica_count":{
                        "runtimeValue":{
                           "constant":1.0
                        }
                     },
                     "deployed_model_display_name":{
                        "runtimeValue":{
                           "constant":"deployed_model_display_name"
                        }
                     },
                     "explanation_metadata":{
                        "runtimeValue":{
                           "constant":{
                              "xai_m":"bar"
                           }
                        }
                     },
                     "explanation_parameters":{
                        "runtimeValue":{
                           "constant":{
                              "xai_p":"foo"
                           }
                        }
                     },
                     "service_account":{
                        "runtimeValue":{
                           "constant":"fake-sa"
                        }
                     },
                     "traffic_split":{
                        "runtimeValue":{
                           "constant":{

                           }
                        }
                     },
                     "encryption_spec_key_name":{
                        "runtimeValue":{
                           "constant":"some encryption_spec_key_name"
                        }
                     },
                     "network":{
                        "runtimeValue":{
                           "constant":"fake-network"
                        }
                     },
                     "sync":{
                        "runtimeValue":{
                           "constant":1.0
                        }
                     },
                     "deploy_request_timeout":{
                        "runtimeValue":{
                           "constant":600.0
                        }
                     },
                     "autoscaling_target_cpu_utilization":{
                        "runtimeValue":{
                           "constant":1.0
                        }
                     },
                     "autoscaling_target_accelerator_duty_cycle":{
                        "runtimeValue":{
                           "constant":1.0
                        }
                     }
                  }
               },
               "taskInfo":{
                  "name":"model-deploy"
               }
            },
            "model-undeploy":{
               "cachingOptions":{
                  "enableCache":true
               },
               "componentRef":{
                  "name":"comp-model-undeploy"
               },
               "dependentTasks":[
                  "endpoint-create",
                  "model-deploy",
                  "model-upload"
               ],
               "inputs":{
                  "artifacts":{
                     "endpoint":{
                        "taskOutputArtifact":{
                           "outputArtifactKey":"endpoint",
                           "producerTask":"endpoint-create"
                        }
                     },
                     "model":{
                        "taskOutputArtifact":{
                           "outputArtifactKey":"model",
                           "producerTask":"model-upload"
                        }
                     }
                  }
               },
               "taskInfo":{
                  "name":"model-undeploy"
               }
            },
            "model-upload":{
               "cachingOptions":{
                  "enableCache":true
               },
               "componentRef":{
                  "name":"comp-model-upload"
               },
               "inputs":{
                  "parameters":{
                     "artifact_uri":{
                        "runtimeValue":{
                           "constant":"project/test_artifact_uri"
                        }
                     },
                     "display_name":{
                        "runtimeValue":{
                           "constant":"test_display_name"
                        }
                     },
                     "project":{
                        "runtimeValue":{
                           "constant":"test_project"
                        }
                     },
                     "serving_container_image_uri":{
                        "runtimeValue":{
                           "constant":"gcr.io/test_project/test_image:test_tag"
                        }
                     }
                  }
               },
               "taskInfo":{
                  "name":"model-upload"
               }
            }
         }
      }
   }
}
